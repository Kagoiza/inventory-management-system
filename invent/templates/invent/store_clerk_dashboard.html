{% extends 'invent/base_store_clerk.html' %}
{% load static %}

{% block title %}Store Clerk Dashboard{% endblock %}

{% block content %}
    <h2 class="mb-3">Hello {{ user.first_name|default:user.username }}</h2>

    <div class="d-flex flex-wrap gap-3 mb-4">
        <a class="btn btn-outline-primary" href="{% url 'issue_item' %}">üì§ Issue Item</a>
        <a class="btn btn-outline-secondary" href="{% url 'manage_stock' %}">‚öôÔ∏è Manage Stock</a>
        <a class="btn btn-outline-dark" href="{% url 'adjust_stock' %}">üîß Adjust Stock</a>
        <a class="btn btn-outline-success" href="{% url 'upload_inventory' %}">üì• Upload Inventory</a>
        <a class="btn btn-outline-info" href="{% url 'list_issued_requests_for_return' %}">‚Ü©Ô∏è Return Item</a>
    </div>

    <!-- Updated Cards Section -->
    <div class="row text-center mb-4">
        <!-- Card 1: Total Inventory Items -->
        <div class="col-12 col-sm-6 col-md mb-3">
            <div class="dashboard-card bg-success text-white p-3 rounded shadow-sm h-100">
                <h6>Total Inventory Items</h6>
                <h3>{{ total_items }}</h3>
            </div>
        </div>
        
        <!-- Card 2: Quantity Issued -->
        <div class="col-12 col-sm-6 col-md mb-3">
            <div class="dashboard-card bg-light border p-3 rounded shadow-sm h-100">
                <h6>Quantity Issued (Aggregate)</h6>
                <h3>{{ items_issued }}</h3>
            </div>
        </div>
        
        <!-- Card 3: Quantity Returned -->
        <div class="col-12 col-sm-6 col-md mb-3">
            <div class="dashboard-card bg-light border p-3 rounded shadow-sm h-100">
                <h6>Quantity Returned (Aggregate)</h6>
                <h3>{{ items_returned }}</h3>
            </div>
        </div>
        
        <!-- Card 4: Pending Requests -->
        <div class="col-12 col-sm-6 col-md mb-3">
            <div class="dashboard-card bg-warning text-dark p-3 rounded shadow-sm h-100">
                <h6>Pending Requests</h6>
                <h3>{{ pending_requests_count }}</h3>
            </div>
        </div>
        
        <!-- Card 5: Issued (to be Returned) -->
        <div class="col-12 col-sm-6 col-md mb-3">
            <div class="dashboard-card bg-primary text-white p-3 rounded shadow-sm h-100">
                <h6>Issued (to be Returned)</h6>
                <h3>{{ issued_but_not_fully_returned_count }}</h3>
            </div>
        </div>
    </div>

    <div class="bg-white p-4 rounded shadow-sm mb-4">
        <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
            <h5 class="mb-2 mb-sm-0">Recent Inventory Activity</h5>
            <div class="d-flex gap-2">
                <a href="{% url 'manage_stock' %}" class="btn btn-sm btn-outline-primary">View All Stock</a>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Total Qty</th>
                        <th>Issued Qty</th>
                        <th>Returned Qty (Aggregate)</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        <td>{{ item.id }}</td>
                        <td>{{ item.name }}</td>
                        <td>{{ item.category|default:"N/A" }}</td>
                        <td>{{ item.quantity_total }}</td>
                        <td>{{ item.quantity_issued }}</td>
                        <td>{{ item.quantity_returned }}</td>
                        <td>
                            <span class="badge
                                {% if item.status == 'Approved' or item.status == 'In Stock' %}bg-success
                                {% elif item.status == 'Pending' %}bg-info
                                {% elif item.status == 'Issued' %}bg-primary
                                {% elif item.status == 'Returned' %}bg-secondary
                                {% elif item.is_expired %}bg-dark text-white
                                {% elif item.quantity_remaining <= 5 and item.quantity_remaining > 0 %}bg-warning text-dark
                                {% elif item.quantity_remaining <= 0 %}bg-danger
                                {% else %}bg-info{% endif %}">
                                {{ item.status }}{% if item.is_expired %} (Expired){% endif %}
                            </span>
                        </td>
                        <td><a href="{% url 'edit_item' item.id %}" class="text-success fw-bold">View/Edit</a></td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="8" class="text-center text-muted">No recent inventory items found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
{# Any page-specific JavaScript can go here #}
{% endblock %}